{
  "version": 4,
  "terraform_version": "1.1.4",
  "serial": 108,
  "lineage": "7a8218a2-4a58-3729-f4e6-56c47a7d120c",
  "outputs": {
    "token": {
      "value": "78ca8993-c7c5-429c-fe17-d0f259b5d0d8",
      "type": "string",
      "sensitive": true
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "local_file",
      "name": "template_job_spec",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "variable \"image\" {}\nvariable \"driver\" {}\nvariable \"group_specs\" {}\nvariable \"namespace\" {}\n#variable \"task_specs\" {}\n\njob \"${job_name}\" {\n  namespace = var.namespace\n  datacenters = [\"dc1\"]\n  dynamic \"group\" {\n    for_each = jsondecode(var.group_specs)\n    iterator = group\n    labels = [group.value.group_label]\n    content {\n      meta {\n        image = var.image\n      }\n\n      network {\n        port \"db\" {\n          to = 6379\n        }\n      }\n\n      task \"redis\" {\n        driver = var.driver\n\n        config {\n          image = \"$${NOMAD_META_image}\"\n\n          ports = [\"db\"]\n        }\n\n        resources {\n          cpu    = 500\n          memory = 256\n        }\n      }\n    }\n  }\n\n}\n",
            "content_base64": "dmFyaWFibGUgImltYWdlIiB7fQp2YXJpYWJsZSAiZHJpdmVyIiB7fQp2YXJpYWJsZSAiZ3JvdXBfc3BlY3MiIHt9CnZhcmlhYmxlICJuYW1lc3BhY2UiIHt9CiN2YXJpYWJsZSAidGFza19zcGVjcyIge30KCmpvYiAiJHtqb2JfbmFtZX0iIHsKICBuYW1lc3BhY2UgPSB2YXIubmFtZXNwYWNlCiAgZGF0YWNlbnRlcnMgPSBbImRjMSJdCiAgZHluYW1pYyAiZ3JvdXAiIHsKICAgIGZvcl9lYWNoID0ganNvbmRlY29kZSh2YXIuZ3JvdXBfc3BlY3MpCiAgICBpdGVyYXRvciA9IGdyb3VwCiAgICBsYWJlbHMgPSBbZ3JvdXAudmFsdWUuZ3JvdXBfbGFiZWxdCiAgICBjb250ZW50IHsKICAgICAgbWV0YSB7CiAgICAgICAgaW1hZ2UgPSB2YXIuaW1hZ2UKICAgICAgfQoKICAgICAgbmV0d29yayB7CiAgICAgICAgcG9ydCAiZGIiIHsKICAgICAgICAgIHRvID0gNjM3OQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGFzayAicmVkaXMiIHsKICAgICAgICBkcml2ZXIgPSB2YXIuZHJpdmVyCgogICAgICAgIGNvbmZpZyB7CiAgICAgICAgICBpbWFnZSA9ICIkJHtOT01BRF9NRVRBX2ltYWdlfSIKCiAgICAgICAgICBwb3J0cyA9IFsiZGIiXQogICAgICAgIH0KCiAgICAgICAgcmVzb3VyY2VzIHsKICAgICAgICAgIGNwdSAgICA9IDUwMAogICAgICAgICAgbWVtb3J5ID0gMjU2CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKfQo=",
            "filename": "./jobspec.nomad",
            "id": "696a97a4d9e54f6fd4fd3e9cc69aa22334c5d8d1"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "nomad_acl_policy",
      "name": "dev",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Submit jobs to the dev environment.",
            "id": "dev",
            "name": "dev",
            "rules_hcl": "namespace \"dev\" {\n  policy = \"write\"\n}\n"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "nomad_acl_token",
      "name": "dev",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "accessor_id": "733e4f89-a9bf-ae55-ec42-8935eaec183f",
            "create_time": "2022-07-24 16:19:56.110332 +0000 UTC",
            "global": false,
            "id": "733e4f89-a9bf-ae55-ec42-8935eaec183f",
            "name": "dev",
            "policies": [
              "dev"
            ],
            "secret_id": "78ca8993-c7c5-429c-fe17-d0f259b5d0d8",
            "type": "client"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "nomad_job",
      "name": "app",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "index_key": "region1",
          "schema_version": 0,
          "attributes": {
            "allocation_ids": [],
            "consul_token": null,
            "datacenters": [
              "dc1"
            ],
            "deployment_id": null,
            "deployment_status": null,
            "deregister_on_destroy": true,
            "deregister_on_id_change": true,
            "detach": true,
            "hcl2": [
              {
                "allow_fs": true,
                "enabled": true,
                "vars": {
                  "driver": "docker",
                  "group_specs": "[{\"group_label\":\"api\",\"tags\":80},{\"group_label\":\"ui\",\"tags\":8080},{\"group_label\":\"batman\",\"tags\":8080}]",
                  "image": "redis:3.2",
                  "namespace": "dev"
                }
              }
            ],
            "id": "region1-broker-grp1",
            "jobspec": "variable \"image\" {}\nvariable \"driver\" {}\nvariable \"group_specs\" {}\nvariable \"namespace\" {}\n#variable \"task_specs\" {}\n\njob \"region1-broker-grp1\" {\n  namespace = var.namespace\n  datacenters = [\"dc1\"]\n  dynamic \"group\" {\n    for_each = jsondecode(var.group_specs)\n    iterator = group\n    labels = [group.value.group_label]\n    content {\n      meta {\n        image = var.image\n      }\n\n      network {\n        port \"db\" {\n          to = 6379\n        }\n      }\n\n      task \"redis\" {\n        driver = var.driver\n\n        config {\n          image = \"${NOMAD_META_image}\"\n\n          ports = [\"db\"]\n        }\n\n        resources {\n          cpu    = 500\n          memory = 256\n        }\n      }\n    }\n  }\n\n}\n",
            "json": null,
            "modify_index": "18",
            "name": "region1-broker-grp1",
            "namespace": "dev",
            "policy_override": null,
            "purge_on_destroy": null,
            "region": "global",
            "task_groups": [
              {
                "count": 1,
                "meta": {
                  "image": "redis:3.2"
                },
                "name": "api",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "redis",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              },
              {
                "count": 1,
                "meta": {
                  "image": "redis:3.2"
                },
                "name": "ui",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "redis",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              },
              {
                "count": 1,
                "meta": {
                  "image": "redis:3.2"
                },
                "name": "batman",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "redis",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              }
            ],
            "timeouts": null,
            "type": "service",
            "vault_token": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsInVwZGF0ZSI6MzAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.local_file.template_job_spec"
          ]
        },
        {
          "index_key": "region2",
          "schema_version": 0,
          "attributes": {
            "allocation_ids": [],
            "consul_token": null,
            "datacenters": [
              "dc1"
            ],
            "deployment_id": null,
            "deployment_status": null,
            "deregister_on_destroy": true,
            "deregister_on_id_change": true,
            "detach": true,
            "hcl2": [
              {
                "allow_fs": true,
                "enabled": true,
                "vars": {
                  "driver": "docker",
                  "group_specs": "[{\"group_label\":\"api\",\"tags\":80},{\"group_label\":\"ui\",\"tags\":8080},{\"group_label\":\"batman\",\"tags\":8080}]",
                  "image": "redis:3.2",
                  "namespace": "dev"
                }
              }
            ],
            "id": "region2-broker-grp1",
            "jobspec": "variable \"image\" {}\nvariable \"driver\" {}\nvariable \"group_specs\" {}\nvariable \"namespace\" {}\n#variable \"task_specs\" {}\n\njob \"region2-broker-grp1\" {\n  namespace = var.namespace\n  datacenters = [\"dc1\"]\n  dynamic \"group\" {\n    for_each = jsondecode(var.group_specs)\n    iterator = group\n    labels = [group.value.group_label]\n    content {\n      meta {\n        image = var.image\n      }\n\n      network {\n        port \"db\" {\n          to = 6379\n        }\n      }\n\n      task \"redis\" {\n        driver = var.driver\n\n        config {\n          image = \"${NOMAD_META_image}\"\n\n          ports = [\"db\"]\n        }\n\n        resources {\n          cpu    = 500\n          memory = 256\n        }\n      }\n    }\n  }\n\n}\n",
            "json": null,
            "modify_index": "17",
            "name": "region2-broker-grp1",
            "namespace": "dev",
            "policy_override": null,
            "purge_on_destroy": null,
            "region": "global",
            "task_groups": [
              {
                "count": 1,
                "meta": {
                  "image": "redis:3.2"
                },
                "name": "api",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "redis",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              },
              {
                "count": 1,
                "meta": {
                  "image": "redis:3.2"
                },
                "name": "ui",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "redis",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              },
              {
                "count": 1,
                "meta": {
                  "image": "redis:3.2"
                },
                "name": "batman",
                "task": [
                  {
                    "driver": "docker",
                    "meta": {},
                    "name": "redis",
                    "volume_mounts": null
                  }
                ],
                "volumes": null
              }
            ],
            "timeouts": null,
            "type": "service",
            "vault_token": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsInVwZGF0ZSI6MzAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.local_file.template_job_spec"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "nomad_namespace",
      "name": "dev",
      "provider": "provider[\"registry.terraform.io/hashicorp/nomad\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "",
            "id": "dev",
            "name": "dev",
            "quota": ""
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    }
  ]
}
